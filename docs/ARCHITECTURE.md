## IG Follow Audit â€“ Architecture

### High-Level Architecture

IG Follow Audit is a **Next.js (App Router) + TypeScript** application that runs entirely in the browser. There is no backend service. All Instagram data processing is performed client-side after the user uploads their official Instagram data export ZIP file.

Key characteristics:

- **Next.js App Router** UI in the `app/` directory.
- **Client-side ZIP parsing** via browser APIs and a ZIP library (to be integrated later).
- **No remote storage** of user data; the ZIP and parsed results live in memory (or, optionally, in browser storage like `IndexedDB`/`localStorage`).

### Client-Side ZIP Parsing Approach

1. **File input**
   - User selects an Instagram export ZIP via a file input (`<input type="file" />`).
   - The file is accessed as a `File`/`Blob` object.

2. **Reading the archive**
   - The app uses browser APIs (`File.arrayBuffer()`) to read the ZIP into memory.
   - A browser-compatible ZIP library (e.g., `fflate`, `jszip`, or similar) is used to enumerate and extract entries from the archive.


3. **Parsing internal files**
   - Relevant JSON files (`followers_1.json`, `following.json`) are parsed using `JSON.parse`.
   - **Web Worker Offloading**: Files larger than 10MB are processed in a dedicated Web Worker (`src/workers/zip.worker.ts`) to prevent UI freezing.

4. **In-memory analysis**
   - Set operations (Intersection, Difference) run in `src/lib/instagram/compute.ts`.
   - Results are derived reactively and can be typically computed in <100ms for <10k followers.

5. **Local Persistence Strategy**
   - **Credibility System**: User tags (Category/Activity) are stored in `localStorage` keyed by username.
   - This allows users to "upload a new ZIP" next month but keep their previous tagging work for known accounts.
   - **Privacy**: A "Reset" button is provided to wipe this storage key.

6. **Telemetry (Local)**
   - A lightweight `TelemetryStore` (`src/lib/telemetry.ts`) tracks parse times and counts.
   - Displayed via `src/components/DebugPanel.tsx` (toggleable UI).
   - **No Network**: No analytics events are sent to any external server.

### Frontend Structure (Current)

- `app/layout.tsx`: Root layout, DebugPanel injection.
- `app/page.tsx`: Landing page.
- `src/app/audit/page.tsx`: **Main Application Logic**.
  - State: ZIP data, Computed Results, UI Filters, Selection, Pagination.
- `src/components/UploadZip.tsx`: Reusable ZIP upload + Worker integration.
- `src/lib/instagram/`:
  - `detect.ts`: Heuristics to find correct JSON files.
  - `compute.ts`: Set mathematics.
  - `parsers.ts`: Zod-based (or simple) validation helpers.
- `src/lib/persistence/`: LocalStorage wrappers for Credibility.
- `tests/`: Vitest unit tests for Logic and Persistence.


### Why We Do NOT Use Instagram Login

- **Security**: Asking for an Instagram username/password would require handling highly sensitive credentials, which is out of scope and unnecessary for this tool.
- **TOS compliance**: Automating login flows often conflicts with platform terms of service; using the official export mechanism aligns better with how Instagram expects third-party tools to access data.
- **User trust**: Users retain full control by generating exports directly from Instagram and providing only that file to the app.

By relying exclusively on the official data export ZIP, the app avoids:

- Storing or transmitting credentials.
- Dealing with rate limits or API changes.
- Maintaining any server infrastructure.

### Why We Do NOT Automate Unfollow or Other Actions

- **Scope**: IG Follow Audit is an **analysis and insight tool**, not an automation bot.
- **Risk**: Automated unfollow or bulk actions can trigger platform protections, violate policies, or get accounts restricted.
- **User control**: Users can use the insights generated by the app to make manual decisions in the official Instagram app or website.

The app will therefore:

- Never attempt to perform API calls against Instagram.
- Never simulate user actions (clicks, scrolls, etc.) inside the Instagram UI.

### Frontend Structure

- `app/layout.tsx`: Root layout, global styles (Tailwind, dark theme).
- `app/page.tsx`: Landing page and entry point for future upload/analysis UI.
- `app/globals.css`: Tailwind layers and base styling.
- `tests/`: Vitest + React Testing Library tests to keep the UI and parsing helpers reliable.

Over time, additional folders (e.g., `app/upload`, `app/insights`, `lib/parsing`) will be introduced to organize upload flows, parsing utilities, and analysis logic.
